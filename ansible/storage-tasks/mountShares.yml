---
- name: Create CIFS credentials file
  copy:
    content:
      username={{CIFS_Username}}
      password={{CIFS_Password}}
    dest: "{{CIFS_credential_location}}"
    mode: '0600'

- name: Create personal folders for users
  file:
    path: /{{zfs.poolName}}/personal/{{item.name}}
    state: directory
    owner: "{{item.name}}"
    group: "{{item.name}}"
    mode: "0770"
  with_items:
    - "{{users}}"

- name: Mount proxmox ssd_storage volume
  mount:
    src: "//{{ item.ip }}/{{ item.name }}"
    path: "/mnt/{{ item.name }}"
    opts: "{{ smb_options }}"
    fstype: cifs
    state: "{{ item.state }}"
  with_items:
    "{{ shares_mount }}"